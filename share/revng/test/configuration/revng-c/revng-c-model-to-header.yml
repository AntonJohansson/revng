#
# Copyright (c) rev.ng Labs Srl. See LICENSE.md for details.
#

tags:
  - name: model-to-header
sources:
  - tags: [model-to-header]
    prefix: share/revng/test/tests/model-to-header
    members:
      - struct.h.model.yml
      - primitive-types.h.model.yml
      - union.h.model.yml
      - pointer-to-struct.h.model.yml
      - inline-struct.h.model.yml
      - do-not-inline-types-pointing-to-itself.h.model.yml
      - do-not-generate-struct-for-stack-type.h.model.yml
      - do-not-inline-used-stack-type.h.model.yml
      - inline-enum.h.model.yml
      - inline-union.h.model.yml
commands:
  - type: revng-c.model-to-header-unit-test
    from:
      - type: source
        filter: model-to-header
    command: |-
      HEADER="$$(temp)";
      cat "$INPUT" | revng model to-header | revng ptml --plain > "$$HEADER".h;
      revng check-decompiled-c "$$HEADER".h;
      FileCheck --input-file="$$HEADER".h "${SOURCE}.filecheck";
