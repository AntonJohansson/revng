#
# This file is distributed under the MIT License. See LICENSE.md for details.
#

commands:
  #
  # Run revng-c's initial autoanalysis
  #
  - type: revng-c.analyzed-model
    from:
      - type: revng-qa.compiled
        filter: one-per-architecture
      - type: revng.analyzed-model
    suffix: .yml
    command: |-
      revng analyze --model "$INPUT2" revng-c-initial-auto-analysis "$INPUT1" -o "$OUTPUT";

  #
  # Produce convert-to-mlir from revng-c.analyzed-model
  #
  - type: revng-c.convert-to-mlir
    from:
      - type: revng-qa.compiled
        filter: one-per-architecture
      - type: revng-c.analyzed-model
    suffix: .mlir
    command: |-
      revng artifact --model "$INPUT2" convert-to-mlir "$INPUT1" -o "$OUTPUT";
