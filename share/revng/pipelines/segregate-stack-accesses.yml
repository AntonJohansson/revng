#
# Copyright (c) rev.ng Labs Srl. See LICENSE.md for details.
#

Component: revng-c
Branches:
  - From: EarlyOptimizeForDecompilation
    Steps:
      - Name: DetectStackSize
        Pipes:
          - Type: LLVMPipe
            UsedContainers: [module.ll]
            Passes:
              - remove-stack-alignment
              - instrument-stack-accesses
              - instcombine
              - remove-extractvalues
              - compute-stack-accesses-bounds
      - Name: SegregateStackAccesses
        Pipes:
          - Type: LLVMPipe
            UsedContainers: [module.ll]
            Passes:
              - hoist-struct-phis
              - segregate-stack-accesses
      - Name: LateOptimizeForDecompilation
        Pipes:
          - Type: LLVMPipe
            UsedContainers: [module.ll]
            Passes:
              - cleanup-stack-size-markers
              - dce
              - sroa
              - instcombine
              - remove-extractvalues
              - sroa
              - simplify-cfg-with-hoist-and-sink
              - loop-rewrite-with-canonical-induction-variable
              - simplify-cfg-with-hoist-and-sink
              - instcombine
              - remove-extractvalues
              - early-cse
              - dce
              - strip-dead-prototypes
              - split-overflow-intrinsics
              - dce
      - Name: MakeSegmentRefs
        Pipes:
          - Type: MakeSegmentRefs
            UsedContainers: [input, module.ll]
            Passes:
              - make-segment-ref
        Artifacts:
          Container: module.ll
          Kind: StackAccessesSegregated
          SingleTargetFilename: stack_access_segregate.ll
